# 六都房價與變數分析 R Script 說明

本專案使用 R 語言分析台灣六都（台北市、新北市、桃園市、台中市、台南市、高雄市）的住宅房價，結合人口流動、CPI、利率、所得、失業率等變數，進行資料處理、視覺化、模型建構、時間序列預測與共線性檢查，並進一步建立固定效果模型、GLS、自訂函數與異常偵測，完整揭示城市房價動態與變數影響。

---

## 📦 套件安裝與載入

使用以下主要套件進行資料處理與模型分析：

- `tidyverse`、`readr`、`lubridate`：資料清理、轉換、匯入  
- `janitor`、`purrr`：欄位標準化與自定 outlier 函式  
- `forecast`、`car`、`lmtest`、`sandwich`：回歸分析與假設檢定  
- `broom`、`ggcorrplot`、`ggpubr`：視覺化與模型摘要  
- `nlme`、`plm`：GLS 與 Panel 回歸分析  

---

## 🧼 資料前處理

1. 載入 `六都房價整合表_UTF8.csv`  
2. 清除欄位換行與數字中的逗號  
3. 建立分析欄位：  
   - `日期`：合併年月欄位轉換為 `Date`  
   - `人口淨流入`：遷入人數 - 遷出人數  
4. 使用 `parse_number()` 統一欄位型別  

---

## 🧪 極端值處理

實作通用函數 `remove_outlier()`，支援：

- 方法：`"iqr"` 或 `"z"`  
- 自訂倍率（如 IQR * 1.5 或 Z-score 2.5）  
- 可指定多欄位同時過濾  

---

## 📈 城市別視覺化分析（❶–❹）

每個城市輸出 4 張圖：

1. 房價（中位）與人口淨流入趨勢  
2. CPI vs 房價（平均）  
3. 利率 vs 房價（平均）  
4. ARIMA 預測未來 60 期房價（以最早期為起點）  

---

## 🌐 全域變數分析（❺–❿）

5. 人口淨流入 vs 房價（平均）  
6. 失業率 vs 房價（平均）+ IQR 去極值  
7. 房價變化率 vs 利率變化率 + Z-score 去極值  
8. 六都平均房價時間趨勢  
9. 房價變化率 vs 人口淨流入變化率  
10. 各城市房價預測 RMSE（標記異常值）  

---

## 🥇 排名與異常分析

- 計算平均房價排名 (`房價排名.csv`)  
- 使用 ARIMA 殘差偵測異常點，計算異常次數並視覺化  
- 房價排名變化圖（點圖、折線圖兩版）  
- 顯示殘差最大前 10 筆觀測值  
- 偵測「人口減少但房價上升」矛盾案例  

---

## 🧮 線性模型建構與診斷

- 多元線性回歸模型（含 CPI、所得、利率等解釋變數）  
- 共線性檢查（VIF 指標與相關係數熱圖）  
- 殘差三圖：預測 vs 殘差、Q-Q plot、自相關時間序列  
- 檢定：Durbin–Watson、Breusch–Pagan、Robust SE  
- 加入 log 與交互項之優化模型，並比較 Adj.R² 與 AIC  

---

## 📊 進階迴歸模型與比較

- **城市與月份固定效果模型**（`lm()`）  
- **GLS 模型**：使用 `gls()` 搭配 `corAR1` 修正自相關  
- **Panel 固定效果模型**（two-way FE）：以 `plm()` 實作  
- **模型比較表**（AIC、Adj.R²、含 NA 標註）  

---

## 🧩 斜率差異分析與 Wald 檢定

- 模型：加入 `人口淨流入 × 城市` 的交互項檢查斜率差異  
- 使用 Wald Test 同時檢定所有城市斜率是否不同  
- 視覺化各城市「人口 → 房價」斜率 + 信賴區間圖  

---

## 📂 輸出項目與結構

所有結果統一輸出至 `output/` 資料夾：

### 📊 圖片（PNG）

- ❶–❹ 每城市圖表  
- ❺–❿ 全域分析圖表  
- 房價排名圖、殘差診斷圖、斜率對比圖、排名變化圖  
- 模型診斷與時間序列預測圖等  

### 📄 資料表格（CSV）

- 房價平均與排名 (`房價排名.csv`)  
- 各城市 RMSE、殘差異常清單、最大殘差資料  
- 模型比較表（含 GLS / FE / Panel）  
- 城市與時間固定效果係數表  
- 各城市斜率係數與信賴區間  

### 📜 模型摘要（TXT）

- 多種模型摘要與結果  
- Durbin–Watson、Breusch–Pagan、Wald Test 等檢定輸出  
- Robust SE 與 Panel Robust 係數結果  

---

## ✅ 適合對象

- 想深入探討六都房價與社經變數關聯者  
- 有 R 基礎，欲進一步學習時間序列、回歸診斷與 Panel 資料分析者  
- 資料科學、社會科學、都市規劃等領域研究者  

---

## ▶️ 使用方法

確保目錄中有 六都房價整合表_UTF8.csv 與 six_city_analysis.R，並安裝所有套件後即可執行：

```r
source("six_city_analysis.R")